{"version":3,"file":"udem-urgence.cjs","sources":["../src/components/udem-urgence/udem-urgence.js","../src/constants.js"],"sourcesContent":["import { Task } from '@lit/task'\nimport { LitElement, html, css, unsafeCSS } from 'lit'\nimport { SPACE_KEY, ENTER_KEY } from '../../constants'\nimport styles from './udem-urgence.scss?inline'\n\n/**\n * Un avis\n * Affiche un avis\n */\nexport class UdeMUrgence extends LitElement {\n  static properties = {\n    service: {\n      type: String\n    },\n    grand: {\n      type: Boolean,\n      // reflect: true\n    },\n    href: {\n      type: String,\n      attribute: false\n    }\n  }\n\n  static styles = [\n    css`${unsafeCSS(styles)}`\n  ]\n\n  constructor() {\n    super()\n\n    this.grand = false\n    this.service = 'https://urgence.umontreal.ca/urgence-udem.json'\n  }\n\n  connectedCallback() {\n    super.connectedCallback()\n    this.render()\n  }\n\n  #urgenceTask = new Task(this, {\n    task: async ([service], { signal }) => {\n      const url = new URL(service)\n      const response = await fetch(url, {\n        headers: {\n          \"Accept\": \"application/json\"\n        },\n        signal\n      })\n      if (!response.ok) {\n        throw new Error(response.status)\n      }\n      return response.json()\n    },\n    args: () => [this.service]\n  })\n\n  #onTitleClick(event) {\n    event.preventDefault()\n    event.stopPropagation()\n  }\n\n  #onActivate(event) {\n    const isKeyboardActivateEvent = event.key === SPACE_KEY || event.key === ENTER_KEY\n\n    if (isKeyboardActivateEvent || event.type === 'click') {\n      window.open(this.href, '_blank')\n    }\n  }\n\n  render() {\n    return this.#urgenceTask.render({\n      pending: () => null,\n      complete: ({ bannerType, date, fullDay, headerLink, hour, title, url }) => {\n        this.href = headerLink ?? url\n\n        if (bannerType) {\n          this.grand = bannerType === 'large'\n        }\n\n        return title && html`\n          <aside class=\"wrapper\" tabindex=\"0\" @click=\"${this.#onActivate}\" @keyup=\"${this.#onActivate}\">\n            <div class=\"container\">\n              <div class=\"content\">\n                <a class=\"title\" href=\"${this.href}\" @click=\"${this.#onTitleClick}\" tabindex=\"-1\">\n                  <div>${title}</div>\n                </a>\n                <time datetime=\"${date}\" class=\"datetime\">\n                  <span class=\"hour\">${hour}</span>\n                  <span> | </span>\n                  <span classid=\"date\">${fullDay}</span>\n                </time>\n              </div>\n            </div>\n          </aside>\n      `},\n\n    })\n  }\n}\n\ncustomElements.define('udem-urgence', UdeMUrgence)","export const ENTER_KEY = 'Enter'\nexport const SPACE_KEY = ' '\n"],"names":["UdeMUrgence","LitElement","constructor","super","__privateAdd","this","_t","_i","urgenceTask","Task","task","async","service","signal","t","url","URL","response","fetch","headers","Accept","ok","Error","status","json","args","grand","connectedCallback","render","pending","complete","bannerType","date","fullDay","headerLink","hour","title","href","html","onActivate","onTitleClick","WeakSet","t_fn","event","preventDefault","stopPropagation","i_fn","key","type","window","open","static","String","Boolean","attribute","css","unsafeCSS","customElements","define"],"mappings":"wiBASO,MAAMA,UAAoBC,EAAAA,WAmB/B,WAAAC,GACEC,QA4BFC,EAAAC,KAAAC,GAKAF,EAAAC,KAAAE,GAtBAC,EAAAA,KAAAA,EAAe,IAAIC,EAAIA,KAACJ,KAAM,CAC5BK,KAAMC,OAAQC,IAAYC,OACxBC,MAAA,MAAMC,EAAM,IAAIC,IAAIJ,GACdK,QAAiBC,MAAMH,EAAK,CAChCI,QAAS,CACPC,OAAU,oBAEZP,WAEF,IAAKI,EAASI,GACN,MAAA,IAAIC,MAAML,EAASM,QAE3B,OAAON,EAASO,QAElBC,KAAM,IAAM,CAACpB,KAAKO,YAvBbc,KAAAA,OAAQ,EACbrB,KAAKO,QAAU,gDAChB,CAED,iBAAAe,GACQA,MAAAA,oBACNtB,KAAKuB,QACN,CAgCD,MAAAA,GACSvB,SAAAA,OAAAA,yDAAkBuB,OAAO,CAC9BC,QAAS,IAAM,KACfC,SAAU,EAAGC,aAAYC,KAAMC,EAAAA,QAAAA,EAASC,aAAYC,KAAMC,EAAAA,MAAAA,EAAOrB,IAC/DV,MAAAA,KAAKgC,KAAOH,GAAcnB,EAEtBgB,IACF1B,KAAKqB,MAAuB,UAAfK,GAGRK,GAASE,EAAAA,IAAAA,+CACgCjC,EAAKkC,KAAAA,EAAAA,eAAwBlC,EAAAA,OAG5CA,0EAAAA,KAAKgC,iBAAiBhC,EAAAA,KAAKmC,EAAAA,0BAC3CJ,8BAESJ,0CACKG,gDAEEF,kDAQtC,EA1DDzB,EAAAA,IAAAA,QAiBAF,EAAA,IAAAmC,QAAAC,EAAAF,SAAcG,GACZA,EAAMC,iBACND,EAAME,iBACP,EAEDtC,EAAA,IAAAkC,QAAAK,EAAAP,SAAYI,IC7DW,MD8DWA,EAAMI,KC/DjB,UD+DsCJ,EAAMI,KAEnB,UAAfJ,EAAMK,OACnCC,OAAOC,KAAK7C,KAAKgC,KAAM,SAE1B,EA1DDc,EADWnD,EACS,aAAA,CAClBY,QAAS,CACPoC,KAAMI,QAER1B,MAAO,CACLsB,KAAMK,SAGRhB,KAAM,CACJW,KAAMI,OACNE,WAAW,KAIfH,EAfWnD,WAeK,CACduD,EAAAA,MAAMC,EAAAA,ikCA4EVC,eAAeC,OAAO,eAAgB1D"}