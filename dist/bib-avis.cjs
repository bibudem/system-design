/**
 * Librairie du system desing des Bibliothèques de l'Université de Montréal
 * @module @bibudem/ui
 * @version 0.10.0
 * @author Christian Rémillard <christian.remillard@umontreal.ca>
 * @license ISC
 * @see https://github.com/bibudem/ui
 */
var e,t,n,s,r,i,o,a,c,l,u,d,h=Object.defineProperty,b=(e,t,n)=>(((e,t,n)=>{t in e?h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n),p=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},g=(e,t,n)=>(p(e,t,"read from private field"),n?n.call(e):t.get(e)),f=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},v=(e,t,n,s)=>(p(e,t,"write to private field"),s?s.call(e,n):t.set(e,n),n),w=(e,t,n)=>(p(e,t,"access private method"),n);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const m=require("./task-YmD7yWl1.cjs"),y=require("./lit-element-BHNMc-Kg.cjs"),x=require("./unsafe-html-B2HbvLQ3.cjs"),k=(e,t)=>t.some((t=>e instanceof t));let B,D;const E=new WeakMap,I=new WeakMap,S=new WeakMap;let L={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return E.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return M(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function j(e){L=e(L)}function M(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const s=()=>{e.removeEventListener("success",r),e.removeEventListener("error",i)},r=()=>{t(M(e.result)),s()},i=()=>{n(e.error),s()};e.addEventListener("success",r),e.addEventListener("error",i)}));return S.set(t,e),t}(e);if(I.has(e))return I.get(e);const t="function"==typeof(n=e)?(s=n,(D||(D=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(s)?function(...e){return s.apply(C(this),e),M(this.request)}:function(...e){return M(s.apply(C(this),e))}):(n instanceof IDBTransaction&&function(e){if(E.has(e))return;const t=new Promise(((t,n)=>{const s=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",i),e.removeEventListener("abort",i)},r=()=>{t(),s()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",r),e.addEventListener("error",i),e.addEventListener("abort",i)}));E.set(e,t)}(n),k(n,B||(B=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(n,L):n);var n,s;return t!==e&&(I.set(e,t),S.set(t,e)),t}const C=e=>S.get(e),q=["get","getKey","getAll","getAllKeys","count"],W=["put","add","delete","clear"],A=new Map;function $(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(A.get(t))return A.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,r=W.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!r&&!q.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,r?"readwrite":"readonly");let o=i.store;return s&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&i.done]))[0]};return A.set(t,i),i}j((e=>({...e,get:(t,n,s)=>$(t,n)||e.get(t,n,s),has:(t,n)=>!!$(t,n)||e.has(t,n)})));const z=["continue","continuePrimaryKey","advance"],P={},T=new WeakMap,O=new WeakMap,F={get(e,t){if(!z.includes(t))return e[t];let n=P[t];return n||(n=P[t]=function(...e){T.set(this,O.get(this)[t](...e))}),n}};async function*V(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;const n=new Proxy(t,F);for(O.set(n,t),S.set(n,C(t));t;)yield n,t=await(T.get(n)||t.continue()),T.delete(n)}function K(e,t){return t===Symbol.asyncIterator&&k(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&k(e,[IDBIndex,IDBObjectStore])}j((e=>({...e,get:(t,n,s)=>K(t,n)?V:e.get(t,n,s),has:(t,n)=>K(t,n)||e.has(t,n)})));const N="avis";async function U(e){const t=(new TextEncoder).encode(JSON.stringify(e)),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}class R extends y.s{constructor(){super(),f(this,n),f(this,r),f(this,o),f(this,c),f(this,u),f(this,e,void 0),f(this,t,void 0),b(this,"_avisTask",new m.h(this,{task:async([e,t,n],{signal:s})=>{const r=new URL(`${t}/${n}`,e),i=await fetch(r,{headers:{Accept:"application/json"},signal:s});if(!i.ok)throw new Error(i.status);return i.json()},args:()=>[this.service,this.contexte,this.niveau]})),v(this,e,null),this.service="https://avis.bib.umontreal.ca",this.contexte="site-web-dev",this.niveau="important",this.boutonFermer=!1}connectedCallback(){super.connectedCallback(),w(this,n,s).call(this)}_renderBoutonFermer(){return this.boutonFermer?y.x`<button class="btn-close" aria-label="Fermer" @click="${w(this,u,d)}">${x.o('<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M480-424 284-228q-11 11-28 11t-28-11q-11-11-11-28t11-28l196-196-196-196q-11-11-11-28t11-28q11-11 28-11t28 11l196 196 196-196q11-11 28-11t28 11q11 11 11 28t-11 28L536-480l196 196q11 11 11 28t-11 28q-11 11-28 11t-28-11L480-424Z"/></svg>')}</button>`:null}render(){return g(this,e)?.message?y.x`<aside class="container"><div class="inner"><div class="message">${x.o(g(this,e).message)}</div>${this._renderBoutonFermer()}</div></aside>`:null}setMessage(t){v(this,e,"string"==typeof t?{message:t,isLocal:!0}:t)}}e=new WeakMap,t=new WeakMap,n=new WeakSet,s=function(){return new m.h(this,{task:async([e,t,n],{signal:s})=>{const o=new Promise((async(r,i)=>{if(""!==this.textContent.trim())return r({isLocal:!0,message:this.innerHTML.split(/<!--\?lit\$\d+\$-->/).join("")});const o=new URL(`${t}/${n}`,e),a=await fetch(o,{headers:{Accept:"application/json"},signal:s});if(!a.ok)return i(new Error(a.status));const{message:c}=await a.json();r({isLocal:!1,message:c})}));try{const e=await o;await w(this,r,i).call(this,e)}catch(a){console.error("[#getAvis] An error occured: %o",a)}return data},args:()=>[this.service,this.contexte,this.niveau]})},r=new WeakSet,i=async function(e){if(!e.message)return void this.setMessage(null);if(!("indexedDB"in window))return void this.setMessage(e.message);const n=v(this,t,await function(e,t,{blocked:n,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(e,t),a=M(o);return s&&o.addEventListener("upgradeneeded",(e=>{s(M(o.result),e.oldVersion,e.newVersion,M(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{i&&e.addEventListener("close",(()=>i())),r&&e.addEventListener("versionchange",(e=>r(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}("@bibudem/ui",1,{upgrade(e){e.objectStoreNames.contains(N)||e.createObjectStore(N)}}));try{const t=await U(e),s=await n.get(N,t);s?s.hidden||(await n.delete(N,t),w(this,o,a).call(this,s)):w(this,o,a).call(this,e)}catch(s){console.error("Something went wrong with indexedDB: %o",s),this.setMessage(e.message)}},o=new WeakSet,a=async function(e){if(this.dispatchEvent(new CustomEvent("bib:show",{bubbles:!0,cancelable:!0}))&&(this.setMessage(e),g(this,t))){const n=await U(e);await g(this,t).put(N,{...e,hidden:!1},n)}},c=new WeakSet,l=async function(){if(!this.dispatchEvent(new CustomEvent("bib:hide",{bubbles:!0,cancelable:!0})))return;const n=await U(g(this,e));await g(this,t).put(N,{...g(this,e),hidden:!0},n),v(this,e,null),this.requestUpdate()},u=new WeakSet,d=function(){w(this,c,l).call(this)},b(R,"properties",{service:{type:String},contexte:{type:String,default:"site-web"},niveau:{type:String},boutonFermer:{type:Boolean,attribute:"bouton-fermer"},message:{state:!0}}),b(R,"styles",[y.i`${y.r(':host,*{box-sizing:border-box}:host{display:block;font-size:var(--bib-avis-size, var(--md-sys-typescale-title-medium-size, inherit));background:var(--bib-avis-container-color, var(--md-sys-color-warningContainer, #fffac6))}:host([hidden]){display:none}.inner{display:flex;align-items:center;margin:0 auto;padding:11px 19px;gap:1em}:host(:not([fluide])) .inner{max-width:1220px}.message{flex-grow:1;min-height:24px}.btn-close{display:inline-flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0px;border:0px;margin:0;cursor:pointer;user-select:none;vertical-align:middle;appearance:none;text-decoration:none;text-align:center;flex:0 0 auto;font-size:1.5rem;font-size:36px;font-weight:700;line-height:1;position:relative;padding:0;border-radius:50%;overflow:visible;color:var(--bib-btn-close-color, rgba(0, 0, 0, .4));transition:color .15s cubic-bezier(.4,0,.2,1),background-color .15s cubic-bezier(.4,0,.2,1)}.btn-close:after{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);min-height:44px;min-width:44px;width:100%;height:100%}.btn-close:focus:not([disabled]),.btn-close:focus-visible{outline:2px solid #bde4ff;outline-offset:3px}.btn-close:focus:not(:focus-visible){outline:0}.btn-close:hover{color:var(--bib-btn-close-hover-color, rgba(0, 0, 0, .8))}.btn-close:hover:after{background-color:#0000000a}.btn-close:after{width:calc(100% + 16px);height:calc(100% + 16px);border-radius:50%;background-color:transparent;transition:background-color .15s cubic-bezier(.4,0,.2,1) 0ms}.btn-close>svg{fill:currentColor}')}`,y.i``]),customElements.define("bib-avis",R),exports.BibAvis=R;
//# sourceMappingURL=bib-avis.cjs.map
