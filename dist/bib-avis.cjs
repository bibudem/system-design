/**
 * Librairie du system desing des Bibliothèques de l'Université de Montréal
 * @module @bibudem/ui
 * @version 0.6.2
 * @author Christian Rémillard <christian.remillard@umontreal.ca>
 * @license ISC
 * @see https://github.com/bibudem/ui
 */
var e,t,n,r,s,i,o,a,c,l,u,d,h=Object.defineProperty,p=(e,t,n)=>(((e,t,n)=>{t in e?h(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n),b=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},g=(e,t,n)=>(b(e,t,"read from private field"),n?n.call(e):t.get(e)),f=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},v=(e,t,n,r)=>(b(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),m=(e,t,n)=>(b(e,t,"access private method"),n);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const w=require("./task-BvC2VQCV.cjs"),y=require("./lit-element-B9Hck3Na.cjs");class x{constructor(e){}get _$isConnected(){return this._$parent._$isConnected}_$initialize(e,t,n){this.__part=e,this._$parent=t,this.__attributeIndex=n}_$resolve(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class k extends x{constructor(e){if(super(e),this._value=y.nothing,2!==e.type)throw new Error(`${this.constructor.directiveName}() can only be used in child bindings`)}render(e){if(e===y.nothing||null==e)return this._templateResult=void 0,this._value=e;if(e===y.noChange)return e;if("string"!=typeof e)throw new Error(`${this.constructor.directiveName}() called with a non-string value`);if(e===this._value)return this._templateResult;this._value=e;const t=[e];return t.raw=t,this._templateResult={_$litType$:this.constructor.resultType,strings:t,values:[]}}}k.directiveName="unsafeHTML",k.resultType=1;const B=(D=k,(...e)=>({_$litDirective$:D,values:e}));var D;const I=(e,t)=>t.some((t=>e instanceof t));let S,E;const L=new WeakMap,$=new WeakMap,_=new WeakMap;let j={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return L.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return M(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function C(e){j=e(j)}function M(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{t(M(e.result)),r()},i=()=>{n(e.error),r()};e.addEventListener("success",s),e.addEventListener("error",i)}));return _.set(t,e),t}(e);if($.has(e))return $.get(e);const t="function"==typeof(n=e)?(r=n,(E||(E=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(r)?function(...e){return r.apply(T(this),e),M(this.request)}:function(...e){return M(r.apply(T(this),e))}):(n instanceof IDBTransaction&&function(e){if(L.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{t(),r()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)}));L.set(e,t)}(n),I(n,S||(S=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(n,j):n);var n,r;return t!==e&&($.set(e,t),_.set(t,e)),t}const T=e=>_.get(e),q=["get","getKey","getAll","getAllKeys","count"],W=["put","add","delete","clear"],A=new Map;function z(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(A.get(t))return A.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,s=W.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!q.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,s?"readwrite":"readonly");let o=i.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),s&&i.done]))[0]};return A.set(t,i),i}C((e=>({...e,get:(t,n,r)=>z(t,n)||e.get(t,n,r),has:(t,n)=>!!z(t,n)||e.has(t,n)})));const P=["continue","continuePrimaryKey","advance"],O={},F=new WeakMap,N=new WeakMap,R={get(e,t){if(!P.includes(t))return e[t];let n=O[t];return n||(n=O[t]=function(...e){F.set(this,N.get(this)[t](...e))}),n}};async function*V(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;const n=new Proxy(t,R);for(N.set(n,t),_.set(n,T(t));t;)yield n,t=await(F.get(n)||t.continue()),F.delete(n)}function K(e,t){return t===Symbol.asyncIterator&&I(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&I(e,[IDBIndex,IDBObjectStore])}async function U(e){const t=(new TextEncoder).encode(JSON.stringify(e)),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}C((e=>({...e,get:(t,n,r)=>K(t,n)?V:e.get(t,n,r),has:(t,n)=>K(t,n)||e.has(t,n)})));class H extends y.LitElement{constructor(){super(),f(this,n),f(this,s),f(this,o),f(this,c),f(this,u),f(this,e,void 0),f(this,t,void 0),p(this,"_avisTask",new w.Task(this,{task:async([e,t,n],{signal:r})=>{const s=new URL(`${t}/${n}`,e),i=await fetch(s,{headers:{Accept:"application/json"},signal:r});if(!i.ok)throw new Error(i.status);return i.json()},args:()=>[this.service,this.contexte,this.niveau]})),v(this,e,null),this.service="https://avis.bib.umontreal.ca",this.contexte="site-web-dev",this.niveau="important",this.boutonFermer=!1}connectedCallback(){super.connectedCallback(),m(this,n,r).call(this)}_renderBoutonFermer(){return this.boutonFermer?y.html`<button class="btn-close" aria-label="Fermer" @click="${m(this,u,d)}">${B('<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M480-424 284-228q-11 11-28 11t-28-11q-11-11-11-28t11-28l196-196-196-196q-11-11-11-28t11-28q11-11 28-11t28 11l196 196 196-196q11-11 28-11t28 11q11 11 11 28t-11 28L536-480l196 196q11 11 11 28t-11 28q-11 11-28 11t-28-11L480-424Z"/></svg>')}</button>`:null}render(){return g(this,e)?.message?y.html`<aside class="container"><div class="inner"><div class="message">${B(g(this,e).message)}</div>${this._renderBoutonFermer()}</div></aside>`:null}setMessage(t){v(this,e,"string"==typeof t?{message:t,isLocal:!0}:t)}}e=new WeakMap,t=new WeakMap,n=new WeakSet,r=function(){return new w.Task(this,{task:async([e,t,n],{signal:r})=>{const o=new Promise((async(s,i)=>{if(""!==this.textContent.trim())return s({isLocal:!0,message:this.innerHTML.split(/<!--\?lit\$\d+\$-->/).join("")});const o=new URL(`${t}/${n}`,e),a=await fetch(o,{headers:{Accept:"application/json"},signal:r});if(!a.ok)return i(new Error(a.status));const{message:c}=await a.json();s({isLocal:!1,message:c})}));try{const e=await o;await m(this,s,i).call(this,e)}catch(a){console.error("[#getAvis] An error occured: %o",a)}return data},args:()=>[this.service,this.contexte,this.niveau]})},s=new WeakSet,i=async function(e){if(!e.message)return void this.setMessage(null);if(!("indexedDB"in window))return void this.setMessage(e.message);const n=v(this,t,await function(e,t,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(e,t),a=M(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(M(o.result),e.oldVersion,e.newVersion,M(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{i&&e.addEventListener("close",(()=>i())),s&&e.addEventListener("versionchange",(e=>s(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}("@bibudem/ui",1,{upgrade(e){e.objectStoreNames.contains("avis")||e.createObjectStore("avis")}}));try{const t=await U(e),r=await n.get("avis",t);r?r.hidden||(await n.delete("avis",t),m(this,o,a).call(this,r)):m(this,o,a).call(this,e)}catch(r){console.error("Something went wrong with indexedDB: %o",r),this.setMessage(e.message)}},o=new WeakSet,a=async function(e){if(this.setMessage(e),g(this,t)){const n=await U(e);await g(this,t).add("avis",{...e,hidden:!1},n)}},c=new WeakSet,l=async function(){const n=await U(g(this,e));await g(this,t).put("avis",{...g(this,e),hidden:!0},n),v(this,e,null),this.requestUpdate()},u=new WeakSet,d=function(){m(this,c,l).call(this)},p(H,"properties",{service:{type:String},contexte:{type:String,default:"site-web"},niveau:{type:String},boutonFermer:{type:Boolean,attribute:"bouton-fermer"},message:{state:!0}}),p(H,"styles",[y.css`${y.unsafeCSS(':host,*{box-sizing:border-box}:host{display:block;font-size:var(--bib-avis-size, var(--md-sys-typescale-title-medium-size, inherit));background:var(--bib-avis-container-color, var(--md-sys-color-warningContainer, #fffac6))}:host([hidden]){display:none}.inner{display:flex;align-items:center;margin:0 auto;padding:11px 19px;gap:1em}:host(:not([fluide])) .inner{max-width:1220px}.message{flex-grow:1;min-height:24px}.btn-close{display:inline-flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0px;border:0px;margin:0;cursor:pointer;user-select:none;vertical-align:middle;appearance:none;text-decoration:none;text-align:center;flex:0 0 auto;font-size:1.5rem;font-size:36px;font-weight:700;line-height:1;position:relative;padding:0;border-radius:50%;overflow:visible;color:var(--bib-btn-close-color, rgba(0, 0, 0, .4));transition:color .15s cubic-bezier(.4,0,.2,1),background-color .15s cubic-bezier(.4,0,.2,1)}.btn-close:after{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);min-height:44px;min-width:44px;width:100%;height:100%}.btn-close:focus:not([disabled]),.btn-close:focus-visible{outline:2px solid #bde4ff;outline-offset:3px}.btn-close:focus:not(:focus-visible){outline:0}.btn-close:hover{color:var(--bib-btn-close-hover-color, rgba(0, 0, 0, .8))}.btn-close:hover:after{background-color:#0000000a}.btn-close:after{width:calc(100% + 16px);height:calc(100% + 16px);border-radius:50%;background-color:transparent;transition:background-color .15s cubic-bezier(.4,0,.2,1) 0ms}.btn-close>svg{fill:currentColor}')}`,y.css``]),customElements.define("bib-avis",H),exports.BibAvis=H;
//# sourceMappingURL=bib-avis.cjs.map
