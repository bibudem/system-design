/**
 * Librairie du system desing des Bibliothèques de l'Université de Montréal
 * @module @bibudem/ui
 * @version 0.4.1
 * @author Christian Rémillard <christian.remillard@umontreal.ca>
 * @license ISC
 * @see https://github.com/bibudem/ui
 */
var t,e,s,r,i,n,o,a,c,l,u,h,d=Object.defineProperty,p=(t,e,s)=>(((t,e,s)=>{e in t?d(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s})(t,"symbol"!=typeof e?e+"":e,s),s),g=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},v=(t,e,s)=>(g(t,e,"read from private field"),s?s.call(t):e.get(t)),b=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},f=(t,e,s,r)=>(g(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s),m=(t,e,s)=>(g(t,e,"access private method"),s);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const w=require("./lit-element-B9Hck3Na.cjs"),y=Symbol();
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class _{get taskComplete(){return this._taskComplete||(1===this.status?this._taskComplete=new Promise(((t,e)=>{this._resolveTaskComplete=t,this._rejectTaskComplete=e})):3===this.status?this._taskComplete=Promise.reject(this._error):this._taskComplete=Promise.resolve(this._value)),this._taskComplete}constructor(t,e,s){this._callId=0,this.status=0,(this._host=t).addController(this);const r="object"==typeof e?e:{task:e,args:s};this._task=r.task,this._argsFn=r.args,this._argsEqual=r.argsEqual??k,this._onComplete=r.onComplete,this._onError=r.onError,this.autoRun=r.autoRun??!0,"initialValue"in r&&(this._value=r.initialValue,this.status=2,this._previousArgs=this._getArgs?.())}hostUpdate(){!0===this.autoRun&&this._performTask()}hostUpdated(){"afterUpdate"===this.autoRun&&this._performTask()}_getArgs(){if(void 0===this._argsFn)return;const t=this._argsFn();if(!Array.isArray(t))throw new Error("The args function must return an array");return t}async _performTask(){const t=this._getArgs(),e=this._previousArgs;this._previousArgs=t,t===e||void 0===t||void 0!==e&&this._argsEqual(e,t)||await this.run(t)}async run(t){let e,s;t??=this._getArgs(),this._previousArgs=t,1===this.status?this._abortController?.abort():(this._taskComplete=void 0,this._resolveTaskComplete=void 0,this._rejectTaskComplete=void 0),this.status=1,"afterUpdate"===this.autoRun?queueMicrotask((()=>this._host.requestUpdate())):this._host.requestUpdate();const r=++this._callId;this._abortController=new AbortController;let i=!1;try{e=await this._task(t,{signal:this._abortController.signal})}catch(n){i=!0,s=n}if(this._callId===r){if(e===y)this.status=0;else{if(!1===i){try{this._onComplete?.(e)}catch{}this.status=2,this._resolveTaskComplete?.(e)}else{try{this._onError?.(s)}catch{}this.status=3,this._rejectTaskComplete?.(s)}this._value=e,this._error=s}this._host.requestUpdate()}}abort(t){1===this.status&&this._abortController?.abort(t)}get value(){return this._value}get error(){return this._error}render(t){switch(this.status){case 0:return t.initial?.();case 1:return t.pending?.();case 2:return t.complete?.(this.value);case 3:return t.error?.(this.error);default:throw new Error(`Unexpected status: ${this.status}`)}}}const k=(t,e)=>t===e||t.length===e.length&&t.every(((t,s)=>!w.notEqual(t,e[s])));class x{constructor(t){}get _$isConnected(){return this._$parent._$isConnected}_$initialize(t,e,s){this.__part=t,this._$parent=e,this.__attributeIndex=s}_$resolve(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class C extends x{constructor(t){if(super(t),this._value=w.nothing,2!==t.type)throw new Error(`${this.constructor.directiveName}() can only be used in child bindings`)}render(t){if(t===w.nothing||null==t)return this._templateResult=void 0,this._value=t;if(t===w.noChange)return t;if("string"!=typeof t)throw new Error(`${this.constructor.directiveName}() called with a non-string value`);if(t===this._value)return this._templateResult;this._value=t;const e=[t];return e.raw=e,this._templateResult={_$litType$:this.constructor.resultType,strings:e,values:[]}}}C.directiveName="unsafeHTML",C.resultType=1;const E=(I=C,(...t)=>({_$litDirective$:I,values:t}));var I;const B=(t,e)=>e.some((e=>t instanceof e));let S,D;const A=new WeakMap,$=new WeakMap,j=new WeakMap;let L={get(t,e,s){if(t instanceof IDBTransaction){if("done"===e)return A.get(t);if("store"===e)return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return q(t[e])},set:(t,e,s)=>(t[e]=s,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function T(t){L=t(L)}function q(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,s)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",n)},i=()=>{e(q(t.result)),r()},n=()=>{s(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",n)}));return j.set(e,t),e}(t);if($.has(t))return $.get(t);const e="function"==typeof(s=t)?(r=s,(D||(D=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(r)?function(...t){return r.apply(M(this),t),q(this.request)}:function(...t){return q(r.apply(M(this),t))}):(s instanceof IDBTransaction&&function(t){if(A.has(t))return;const e=new Promise(((e,s)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",n),t.removeEventListener("abort",n)},i=()=>{e(),r()},n=()=>{s(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",n),t.addEventListener("abort",n)}));A.set(t,e)}(s),B(s,S||(S=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(s,L):s);var s,r;return e!==t&&($.set(t,e),j.set(e,t)),e}const M=t=>j.get(t),P=["get","getKey","getAll","getAllKeys","count"],W=["put","add","delete","clear"],U=new Map;function z(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(U.get(e))return U.get(e);const s=e.replace(/FromIndex$/,""),r=e!==s,i=W.includes(s);if(!(s in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!P.includes(s))return;const n=async function(t,...e){const n=this.transaction(t,i?"readwrite":"readonly");let o=n.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[s](...e),i&&n.done]))[0]};return U.set(e,n),n}T((t=>({...t,get:(e,s,r)=>z(e,s)||t.get(e,s,r),has:(e,s)=>!!z(e,s)||t.has(e,s)})));const R=["continue","continuePrimaryKey","advance"],F={},O=new WeakMap,V=new WeakMap,N={get(t,e){if(!R.includes(e))return t[e];let s=F[e];return s||(s=F[e]=function(...t){O.set(this,V.get(this)[e](...t))}),s}};async function*K(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;const s=new Proxy(e,N);for(V.set(s,e),j.set(s,M(e));e;)yield s,e=await(O.get(s)||e.continue()),O.delete(s)}function H(t,e){return e===Symbol.asyncIterator&&B(t,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===e&&B(t,[IDBIndex,IDBObjectStore])}function J(t){return""===t.textContent.trim()}async function Z(t){const e=(new TextEncoder).encode(JSON.stringify(t)),s=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(s)).map((t=>t.toString(16).padStart(2,"0"))).join("")}T((t=>({...t,get:(e,s,r)=>H(e,s)?K:t.get(e,s,r),has:(e,s)=>H(e,s)||t.has(e,s)})));class G extends w.LitElement{constructor(){super(),b(this,s),b(this,i),b(this,o),b(this,c),b(this,u),b(this,t,void 0),b(this,e,void 0),p(this,"_avisTask",new _(this,{task:async([t,e,s],{signal:r})=>{const i=new URL(`${e}/${s}`,t),n=await fetch(i,{headers:{Accept:"application/json"},signal:r});if(!n.ok)throw new Error(n.status);return n.json()},args:()=>[this.service,this.contexte,this.niveau]})),f(this,t,null),this.service="https://avis.bib.umontreal.ca",this.contexte="site-web-dev",this.niveau="important",this.boutonFermer=!1}connectedCallback(){super.connectedCallback(),m(this,s,r).call(this)}_renderBoutonFermer(){return this.boutonFermer?w.html`<button class="btn-close" aria-label="Fermer" @click="${m(this,u,h)}">${E('<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24"><path d="M480-424 284-228q-11 11-28 11t-28-11q-11-11-11-28t11-28l196-196-196-196q-11-11-11-28t11-28q11-11 28-11t28 11l196 196 196-196q11-11 28-11t28 11q11 11 11 28t-11 28L536-480l196 196q11 11 11 28t-11 28q-11 11-28 11t-28-11L480-424Z"/></svg>')}</button>`:null}render(){return v(this,t)?.message?w.html`<aside class="container"><div class="inner"><div class="message">${E(v(this,t).message)}</div>${this._renderBoutonFermer()}</div></aside>`:null}setMessage(e){f(this,t,"string"==typeof e?{message:e,isLocal:!0}:e)}}t=new WeakMap,e=new WeakMap,s=new WeakSet,r=function(){return new _(this,{task:async([t,e,s],{signal:r})=>{console.log("[#getAvis] is empty? %o",J(this));const o=new Promise((async(i,n)=>{if(!J(this))return i({isLocal:!0,message:this.innerHTML.split(/<!--\?lit\$\d+\$-->/).join("")});const o=new URL(`${e}/${s}`,t),a=await fetch(o,{headers:{Accept:"application/json"},signal:r});if(!a.ok)return n(new Error(a.status));const{message:c}=await a.json();i({isLocal:!1,message:c})}));try{const t=await o;console.log("data: %o",t),await m(this,i,n).call(this,t)}catch(a){console.error("[#getAvis] An error occured: %o",a)}return data},args:()=>[this.service,this.contexte,this.niveau]})},i=new WeakSet,n=async function(t){if(!t.message)return void this.setMessage(null);if(!("indexedDB"in window))return void this.setMessage(t.message);const s=f(this,e,await function(t,e,{blocked:s,upgrade:r,blocking:i,terminated:n}={}){const o=indexedDB.open(t,e),a=q(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(q(o.result),t.oldVersion,t.newVersion,q(o.transaction),t)})),s&&o.addEventListener("blocked",(t=>s(t.oldVersion,t.newVersion,t))),a.then((t=>{n&&t.addEventListener("close",(()=>n())),i&&t.addEventListener("versionchange",(t=>i(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}("@bibudem/ui",1,{upgrade(t){t.objectStoreNames.contains("avis")||t.createObjectStore("avis",{keyPath:"id"})}}));try{const e=await Z(t),r=await s.get("avis",e);console.log("storedAvis: ",r),r?r.hidden||(await s.delete("avis",e),m(this,o,a).call(this,r)):m(this,o,a).call(this,t)}catch(r){console.error("Something went wrong with indexedDB: %o",r),this.setMessage(t.message)}},o=new WeakSet,a=async function(t){if(this.setMessage(t),v(this,e)){const s=await Z(t);await v(this,e).add("avis",{...t,hidden:!1},s)}},c=new WeakSet,l=async function(){const s=await Z(v(this,t));await v(this,e).put("avis",{...v(this,t),hidden:!0},s),f(this,t,null),this.requestUpdate()},u=new WeakSet,h=function(){m(this,c,l).call(this)},p(G,"properties",{service:{type:String},contexte:{type:String,default:"site-web"},niveau:{type:String},boutonFermer:{type:Boolean,attribute:"bouton-fermer"},message:{state:!0}}),p(G,"styles",[w.css`${w.unsafeCSS(':host,*{box-sizing:border-box}:host{display:block;font-size:var(--bib-avis-size, var(--md-sys-typescale-title-medium-size, inherit));background:var(--bib-avis-container-color, var(--md-sys-color-warningContainer, #fffac6))}:host([hidden]){display:none}.inner{display:flex;align-items:center;max-width:1220px;margin:0 auto;padding:11px 19px;gap:1em}.message{flex-grow:1;min-height:24px}.btn-close{display:inline-flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0px;border:0px;margin:0;cursor:pointer;user-select:none;vertical-align:middle;appearance:none;text-decoration:none;text-align:center;flex:0 0 auto;font-size:1.5rem;font-size:36px;font-weight:700;line-height:1;position:relative;padding:0;border-radius:50%;overflow:visible;color:var(--bib-btn-close-color, rgba(0, 0, 0, .4));transition:color .15s cubic-bezier(.4,0,.2,1),background-color .15s cubic-bezier(.4,0,.2,1)}.btn-close:after{content:"";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);min-height:44px;min-width:44px;width:100%;height:100%}.btn-close:focus:not([disabled]),.btn-close:focus-visible{outline:2px solid #bde4ff;outline-offset:3px}.btn-close:focus:not(:focus-visible){outline:0}.btn-close:hover{color:var(--bib-btn-close-hover-color, rgba(0, 0, 0, .8))}.btn-close:hover:after{background-color:#0000000a}.btn-close:after{width:calc(100% + 16px);height:calc(100% + 16px);border-radius:50%;background-color:transparent;transition:background-color .15s cubic-bezier(.4,0,.2,1) 0ms}.btn-close>svg{fill:currentColor}')}`,w.css``]),customElements.define("bib-avis",G),exports.BibAvis=G;
//# sourceMappingURL=bib-avis.cjs.map
